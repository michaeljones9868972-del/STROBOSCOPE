<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EXCITE ME</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      font-family: 'Arial Black', sans-serif;
    }
    .splash {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000; /* Гарантированно поверх всего */
      cursor: pointer;
    }
    .text {
      font-size: 64px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 6px;
      color: #D5FB00;
      text-shadow: 
        0 0 10px rgba(213, 251, 0, 0.8),
        0 0 30px rgba(213, 251, 0, 0.6);
      animation: drip 3s infinite alternate, glow 2s ease-in-out infinite alternate;
      white-space: nowrap;
    }
    @keyframes drip {
      0% {
        transform: translateY(0) scale(1);
        text-shadow: 
          0 0 10px #D5FB00,
          0 10px 30px #D5FB00,
          0 20px 50px #D5FB00;
      }
      100% {
        transform: translateY(10px) scale(1.05);
        text-shadow: 
          0 0 15px #D5FB00,
          0 15px 40px #D5FB00,
          0 30px 70px #DE60CA;
      }
    }
    @keyframes glow {
      0% { opacity: 0.8; }
      100% { opacity: 1; }
    }
    .drop {
      position: absolute;
      width: 2px;
      height: 15px;
      background: #D5FB00;
      opacity: 0.6;
      transform-origin: bottom;
      animation: fall linear infinite;
    }
    @keyframes fall {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 0.6; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>

  <!-- Заставка -->
  <div class="splash" id="splash">
    <div class="text">EXCITE ME</div>
  </div>

  <script>
    let MAX_INIT_SIZE, MAX_ANGLE_STEP, SIZE_MULT, MIN_SIZE;
    let initSize, initAngle, initColIndex;
    let url = "https://coolors.co/app/223C20-4C8D26-D5FB00-DE60CA-882380";
    let cols;
    let music;
    let isPlaying = false;

    function preload() {
      // Загружаем музыку (можно заменить на свою ссылку)
      const musicURL = "https://cdn.pixabay.com/audio/2022/04/01/audio_669157382.mp3";
      music = loadSound(musicURL, () => console.log("Музыка загружена"));
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      rectMode(CENTER);
      noStroke();
      cols = createCols(url);

      MAX_INIT_SIZE = max(width, height) * 0.6;
      MAX_ANGLE_STEP = PI / 30;
      SIZE_MULT = 0.92;
      MIN_SIZE = 5;

      initSize = MAX_INIT_SIZE;
      initAngle = 0;
      initColIndex = 0;

      // Генерация капель
      createDrops();

      // Клик по заставке — активация
      document.getElementById('splash').addEventListener('click', activateExperience);
    }

    function draw() {
      if (!isPlaying) return;

      background(0);
      let count = sin(frameCount / 180);
      let angleStep = MAX_ANGLE_STEP * (0.8 + 0.2 * cos(frameCount * 0.01));
      let colIndex = initColIndex;
      let size = initSize;
      let angle = initAngle;

      while (size > MIN_SIZE * 0.5) {
        push();
        translate(width / 2, height / 2);
        rotate(angle);
        stroke(cols[colIndex % cols.length]);
        strokeWeight(1.5);
        noFill();
        ellipse(0, 0, size, size * 0.8);
        pop();

        angle += angleStep * map(size, MIN_SIZE, MAX_INIT_SIZE * 1.5, 1, 0.1, true);
        size *= SIZE_MULT;
        colIndex++;
      }

      initSize += random(-0.3, 0.3);
      initSize = constrain(initSize, MAX_INIT_SIZE * 0.9, MAX_INIT_SIZE * 1.1);
      initAngle += angleStep * 0.05;
    }

    function createDrops() {
      const splash = document.getElementById('splash');
      for (let i = 0; i < 80; i++) {
        const drop = document.createElement('div');
        drop.className = 'drop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDuration = (Math.random() * 3 + 2) + 's';
        drop.style.animationDelay = (Math.random() * 5) + 's';
        splash.appendChild(drop);
      }
    }

    function activateExperience() {
      // Удаляем заставку
      document.getElementById('splash').remove();

      // Полноэкранный режим
      const elem = document.documentElement;
      if (elem.requestFullscreen) {
        elem.requestFullscreen().catch(e => console.log("Полноэкранный режим заблокирован:", e));
      } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      }

      // Показываем анимацию
      document.querySelector('canvas').style.display = 'block';

      // Запускаем музыку
      if (music && !music.isPlaying()) {
        music.setVolume(0.7);
        music.loop();
      }

      isPlaying = true;
    }

    function keyPressed() {
      if (keyCode === ESC || keyCode === 32) {
        // При нажатии Esc или пробела — просто перезагружаем, чтобы выйти
        location.reload();
      }
    }

    function windowResized() {
      if (isPlaying) resizeCanvas(windowWidth, windowHeight);
    }

    function createCols(_url) {
      let slash_index = _url.lastIndexOf('/');
      let palette_str = _url.slice(slash_index + 1);
      let arr = palette_str.split('-');
      for (let i = 0; i < arr.length; i++) {
        arr[i] = '#' + arr[i];
      }
      return arr;
    }
  </script>
</body>
</html>
