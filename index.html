<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Symbol Runner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Martian+Mono:wght@100..800&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
      color: white;
      font-family: 'Martian Mono', monospace;
      height: 100vh;
      position: relative;
    }
    
    /* Фон */
    .a-hole {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    
    .js-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .aura {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(100, 50, 200, 0.2) 0%, transparent 70%);
      pointer-events: none;
      animation: aura-pulse 8s infinite alternate;
    }
    
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        repeating-linear-gradient(0deg, rgba(0,0,0,0.15) 1px, transparent 1px, transparent 20px),
        repeating-linear-gradient(90deg, rgba(0,0,0,0.15) 1px, transparent 1px, transparent 20px);
      pointer-events: none;
    }
    
    @keyframes aura-pulse {
      0% { opacity: 0.3; transform: scale(1); }
      100% { opacity: 0.7; transform: scale(1.2); }
    }

    /* Галерея */
    .gallery {
      position: absolute;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .cards {
      position: relative;
      width: 42rem;
      height: 54rem;
      display: flex;
      align-items: center;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .cards li {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 42rem;
      aspect-ratio: 9 / 16;
      position: absolute;
      background: transparent;
      border: none;
      border-radius: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 9rem;
      font-weight: bold;
      color: #a0d8f1;
      text-shadow: 0 0 10px rgba(160, 216, 241, 0.7);
      opacity: 0;
      scale: 0;
      z-index: 1;
      overflow: hidden;
      cursor: pointer;
    }

    .cards li img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 0;
      display: block;
    }

    .drag-proxy {
      visibility: hidden;
      position: absolute;
    }

    /* Нижняя строка */
    .marquee-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 70px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      z-index: 2;
    }

    .marquee-content {
      white-space: nowrap;
      animation: scroll-left 360s linear infinite;
      font-size: 16px;
      color: #a0d8f1;
      padding: 0 50px;
      font-family: 'Martian Mono', monospace;
      letter-spacing: 0.5px;
    }

    @keyframes scroll-left {
      0% { transform: translateX(100vw); }
      100% { transform: translateX(-100%); }
    }

    @media (max-width: 768px) {
      .cards li { font-size: 6.6rem; }
      .marquee-content { font-size: 14px; }
    }
    
    @media (min-width: 1024px) {
      .cards li { font-size: 10.5rem; }
      .marquee-content { font-size: 18px; }
    }
  </style>
</head>
<body>
  <div class="a-hole">
    <canvas class="js-canvas"></canvas>
    <div class="aura"></div>
    <div class="overlay"></div>
  </div>

  <div class="gallery">
    <ul class="cards" id="cardsList"></ul>
  </div>
  <div class="drag-proxy"></div>

  <div class="marquee-container">
    <div class="marquee-content" id="marqueeContent">
      Stroboscope and music - has a hypnotic effect on the alpha rhythms of the brain of a healthy person and actively stimulates his mental activity! Color is one of the factors that determine the state of our psyche. Psychologists and psychiatrists, based on people's preference or love for a particular color, determine the character of a person, his inclinations, his mindset, psyche, and even his state of health. The influence of color on a person is very great, although in everyday life we do not pay attention to it. Color makes things "heavy", "light", "cold", "hot". It has a tremendous impact on a person, on the work of his organs. Each color evokes a specific reaction in the human brain. For example, if a person is very excited, it is enough to place him in a room with bright pink wallpaper, as he calms down very quickly and even falls asleep. However, it was enough to change the color to blue, as this weakness disappeared. This means that color affects not only mood, but also the whole human body. Red is the color of passion. If this is a favorite color, then such a person is brave, strong-willed, domineering, quick-tempered, sociable. Orange is the favorite color of people with intuition and passionate dreamers, it means health, symbolizes joy, warmth. Yellow - this color symbolizes calmness, intelligence. If this is a favorite color, then such a person is sociable, curious, courageous. Green is the color of nature. The one who prefers it is afraid of someone else's influence, looking for a way to assert himself. Blue - symbolizes truth. This is peace, tranquility, well-being. Blue is the color of the sky. If a person likes him, this speaks of modesty and melancholy; such a person needs to rest, he quickly gets tired. Violet - this color "speaks" of a very great emotionality, sensitivity, delicacy, it is the color of harmoniously developed people. Black is the color of uncertainty, symbolizing a gloomy perception of life. Anyone who loves black, often perceives life in dark colors, is unhappy. White is the synthesis of all colors, because it is the "ideal" color, the "dream color". This color can be preferred by a person with any character, it does not repel anyone.
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Draggable.min.js"></script>

  <script>
    // Бегущая строка
    const marqueeContent = document.getElementById('marqueeContent');
    marqueeContent.innerHTML += ' ' + marqueeContent.innerHTML;

    // Создание карточек
    const cardsList = document.getElementById('cardsList');
    for (let i = 1; i <= 10; i++) {
      const li = document.createElement('li');
      const img = document.createElement('img');
      // Убраны лишние пробелы в URL
      img.src = `https://raw.githubusercontent.com/michaeljones9868972-del/STROBOSCOPE/main/${i}krug.png`;
      img.alt = '';
      li.appendChild(img);
      cardsList.appendChild(li);
    }

    // Клик по карточке → переход
    const cards = document.querySelectorAll('.cards li');
    cards.forEach((card, index) => {
      card.addEventListener('click', () => {
        const pageNumber = index + 1;
        window.location.href = `page${pageNumber}.html`;
      });
    });

    // GSAP setup
    gsap.registerPlugin(ScrollTrigger, Draggable);
    let iteration = 0;
    const gsapCards = gsap.utils.toArray('.cards li');
    gsap.set(gsapCards, { xPercent: 400, opacity: 0, scale: 0 });
    const spacing = 0.1; // шаг между карточками в GSAP timeline
    const snapTime = gsap.utils.snap(spacing);

    const animateFunc = element => {
      const tl = gsap.timeline();
      tl.fromTo(element, { scale: 0, opacity: 0 }, { 
        scale: 1, 
        opacity: 1, 
        zIndex: 100, 
        duration: 0.5, 
        yoyo: true, 
        repeat: 1, 
        ease: "power1.in", 
        immediateRender: false 
      })
      .fromTo(element, { xPercent: 400 }, { 
        xPercent: -400, 
        duration: 1, 
        ease: "none", 
        immediateRender: false 
      }, 0);
      return tl;
    };

    const seamlessLoop = buildSeamlessLoop(gsapCards, spacing, animateFunc);
    const playhead = { offset: 0 };
    const wrapTime = gsap.utils.wrap(0, seamlessLoop.duration());

    const scrub = gsap.to(playhead, {
      offset: 0,
      onUpdate() {
        seamlessLoop.time(wrapTime(playhead.offset));
      },
      duration: 0.5,
      ease: "power3",
      paused: true
    });

    const trigger = ScrollTrigger.create({
      start: 0,
      onUpdate(self) {
        let scroll = self.scroll();
        if (scroll > self.end - 1) {
          wrap(1, 2);
        } else if (scroll < 1 && self.direction < 0) {
          wrap(-1, self.end - 2);
        } else {
          scrub.vars.offset = (iteration + self.progress) * seamlessLoop.duration();
          scrub.invalidate().restart();
        }
      },
      end: "+=3000",
      pin: ".gallery"
    });

    const progressToScroll = progress => gsap.utils.clamp(1, trigger.end - 1, gsap.utils.wrap(0, 1, progress) * trigger.end);
    const wrap = (iterationDelta, scrollTo) => {
      iteration += iterationDelta;
      trigger.scroll(scrollTo);
      trigger.update();
    };

    ScrollTrigger.addEventListener("scrollEnd", () => scrollToOffset(scrub.vars.offset));
    
    function scrollToOffset(offset) {
      let snappedTime = snapTime(offset),
          progress = (snappedTime - seamlessLoop.duration() * iteration) / seamlessLoop.duration(),
          scroll = progressToScroll(progress);
      if (progress >= 1 || progress < 0) return wrap(Math.floor(progress), scroll);
      trigger.scroll(scroll);
    }

    Draggable.create(".drag-proxy", {
      type: "x",
      trigger: ".cards",
      onPress() { this.startOffset = scrub.vars.offset; },
      onDrag() { 
        scrub.vars.offset = this.startOffset + (this.startX - this.x) * 0.001; 
        scrub.invalidate().restart(); 
      },
      onDragEnd() { 
        scrollToOffset(scrub.vars.offset); 
      }
    });

    // ✅ Исправленная плавная прокрутка колёсиком
    let isWheeling = false;
    let wheelTimeout;

    document.addEventListener('wheel', (e) => {
      e.preventDefault();
      if (isWheeling) return;

      const direction = e.deltaY > 0 ? 1 : -1; // вниз = вперёд
      const currentStep = Math.round(scrub.vars.offset / spacing);
      const targetStep = currentStep + direction;

      scrub.vars.offset = targetStep * spacing;
      scrub.invalidate().restart();

      clearTimeout(wheelTimeout);
      wheelTimeout = setTimeout(() => {
        scrollToOffset(scrub.vars.offset);
        isWheeling = false;
      }, 150);

      isWheeling = true;
    }, { passive: false });

    function buildSeamlessLoop(items, spacing, animateFunc) {
      let overlap = Math.ceil(1 / spacing),
          startTime = items.length * spacing + 0.5,
          loopTime = (items.length + overlap) * spacing + 1,
          rawSequence = gsap.timeline({ paused: true }),
          seamlessLoop = gsap.timeline({
            paused: true,
            repeat: -1,
            onRepeat() {
              this._time === this._dur && (this._tTime += this._dur - 0.01);
            }
          }),
          l = items.length + overlap * 2;

      for (let i = 0; i < l; i++) {
        const index = i % items.length;
        const time = i * spacing;
        rawSequence.add(animateFunc(items[index]), time);
      }

      rawSequence.time(startTime);
      seamlessLoop
        .to(rawSequence, { time: loopTime, duration: loopTime - startTime, ease: "none" })
        .fromTo(rawSequence, { time: overlap * spacing + 1 }, {
          time: startTime,
          duration: startTime - (overlap * spacing + 1),
          immediateRender: false,
          ease: "none"
        });
      return seamlessLoop;
    }

    // Частицы
    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.querySelector('.js-canvas');
      const ctx = canvas.getContext('2d');

      const resizeCanvas = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      };
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      const particles = Array.from({ length: 100 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 2 + 1,
        speed: Math.random() * 0.5 + 0.1,
        angle: Math.random() * Math.PI * 2,
        color: `hsl(${Math.random() * 360}, 70%, 60%)`
      }));

      const animateParticles = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          p.x += Math.cos(p.angle) * p.speed;
          p.y += Math.sin(p.angle) * p.speed;
          if (p.x < 0 || p.x > canvas.width) p.angle = Math.PI - p.angle;
          if (p.y < 0 || p.y > canvas.height) p.angle = -p.angle;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.globalAlpha = 0.6;
          ctx.fill();
        });
        requestAnimationFrame(animateParticles);
      };
      animateParticles();
    });
  </script>
</body>
</html>
